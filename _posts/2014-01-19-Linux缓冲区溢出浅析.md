---

layout: post
categories: [System]
tags: [Linux, 栈缓冲区溢出, hack游戏]

---

这几天脑子抽风突然去玩Mac下的软件破解, 在和煎饼果子同学回顾汇编知识的时候提到了栈缓冲区溢出技术, 我发现虽然自己了解它的基本原理但是倘若实践起来很多细节都还是模棱两可, 于是突然兴趣大发搞鼓了起来, 本文算是对这两天学到的做一个简单的总结, 也算是一个纯粹面向Beginner的栈缓冲区溢出初级教程.  

我会阐述原理,同时尽力从实践的角度来一步步地进行说明, 由于水平有限, 不会对现有软件进行实验, 不同平台的栈缓冲区溢出技术都有差异我无力一一讲解, 并且由于不可执行栈等技术的出现导致传统的栈缓冲区溢出基本丧失攻击力, 尽管如此各种攻击手段最基本的原理和思想都很类似, 栈缓冲区溢出无疑是其中最基础的一环必须要掌握, 在这里我选择了以编程游戏闯关的方式来进行讲解, 游戏来自[Narnia](http://www.overthewire.org/wargames/narnia/)的前5道题目, narnia是一个饶有趣味的hack游戏, 本文会对该网站的使用方法进行讲解.

###准备知识
1. 汇编语言  
对于很多人来说, 汇编如同魔法咒文, 没错我也这么想, 不过如果你把汇编语法忘光了我劝你赶快找本书补充一下汇编知识, 要想学习栈缓冲区溢出其实了解几个常用的指令就可以了, 现学现用, 就当时背咒语了, 要知道这咒语念出的魔法可是非常强大的. 要说非要推荐个资料之类的, 反正在学习之前我看了这个链接快速地回顾了一下汇编语言的两种主流语法**AT&T汇编格式**和**Intel汇编格式**: [Linux 汇编语言开发指南](http://www.ibm.com/developerworks/cn/linux/l-assembly/)  

2. 内存管理  
缓冲区溢出简单来说分两种其一是本文着重介绍的栈缓冲区溢出, 其二是堆缓冲区溢出, 栈和堆无疑是内存管理中重要的两个概念, 掌握内存管理的同时也要了解, 二进制可执行文件是如何加载到内存中的, 加载到内存中后代码和数据在内存中的哪个位置, 以及代码是如何在内存中被执行的, 等等这些概念都是非常重要的. 骚年们可以参考这本书: [程序员的自我修养](http://book.douban.com/subject/3652388/), 当然了如果你说你看[CSAP](http://book.douban.com/subject/5333562/), 那就更好了, 估计没我什么事了.

3. gdb  
linux下无论是搞软件破解还是搞缓冲区溢出无处不见此神器的身影, 骚年们先去熟悉下gdb的命令吧, 如果你是Mac OX系统就去了解下lldb的语法, 基本类似但也有不少差别. 我当时查阅的是这个链接给出了gdb和lldb常用的区别: [GDB to LLDB Command Map](http://lldb.llvm.org/lldb-gdb.html)  

4. shell & python  
这和缓冲区溢出显然没什么直接关系, 但是本文主要阐述Linux下的栈缓冲区溢出, shell的使用是必要的, 至于python是为了方便格式化我们想要的二进制串来对你要hack的程序进行输入, 你比如说我要构造包含100个0x90的串, 在python中只要` print "\x90"*100 `就好了, 真是简洁有效. 当然你用其他任何方法来实现同样的效果都没问题. 不管你怎么做, 反正我是这么做的 ^_^.

上面提到的这些准备知识呢, 我在下文中也会重点强调, 让我们开始栈缓冲区溢出的Happy游戏之旅吧~

###登录Narnia
登录游戏之前呢我们先来简单了解一下[Narnia](http://www.overthewire.org/wargames/narnia/), 你们知道纳尼亚传奇么, 讲述了几个少年到衣橱背后世界冒险的故事, 而此时我们也将经历另一场扣人心弦的冒险, 这个游戏从level0至level9共10个关卡, 而我们的冒险就从level0开始到level4结束, 这5个关卡相对比较容易, 并且都是栈缓冲区溢出相关的, 关卡的名称分别是narnia0, narnia1, narnia2, narnia3, narnia4.  

游戏中每一个关卡都需要使用该关卡的用户名和密码通过ssh登录到[narnia.labs.overthewire.org](narnia.labs.overthewire.org)服务器上面.也就是说每一个关卡都拥有自己的用户名和密码, 用户名与关卡名称相同, 即narnia0-narnia4, 而密码则另有门道, 最开始我们只知道narnia0关卡的密码, 这个密码很简单就是"narnia0"字符串, 而其他关卡的密码就不是这么简单的了, 需要成功闯过前一关才能得到下一关的密码, 这就好像在玩密室逃脱游戏, 你获得一个谜题只有解开它才能找到下一个谜题, 就这样串联式地探索下去, 直到密室打开.  

比如我要登录narnia0关卡, 在linux命令行下输入下面的命令, 意思就是以用户名narnia0来登录narnia服务器:  

	ssh -l narnia0 narnia.labs.overthewire.org
	
输入完该命令后,会提示你输入密码, 这时输入"narnia0"即可.  
下面我们就来攻克narnia0关卡! 这是学习栈缓冲区溢出的第一步~.  

###第0关:覆盖栈内存
